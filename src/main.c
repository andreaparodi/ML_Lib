#include "stm32f4xx.h"
#include "stm32f4xx_nucleo.h"
#include "main.h"


int main(void)
{
	HAL_Init();
	MX_USART2_UART_Init();
	I2C1_init();
	BSP_LED_Init(LED2);
//verifico l'effettiva presenza del sensore sul bus i2c e nel caso, inizializzo
	if (LSM6DSL_Who_Am_I() == LSM6DSL_WHO_AM_I_VAL)
	{
		LSM6DSL_present = ENABLE;
		char *msg = "\n\rLSM6DSL found on the I2C bus! \r\n";
		//HAL_UART_Transmit(&huart2, (uint8_t*) msg, strlen(msg), 0xFFFF);
		LSM6DSL_Config();
	}
	else
	{
		char *msg = "\n\rNOT FOUND \r\n";
		//HAL_UART_Transmit(&huart2, (uint8_t*) msg, strlen(msg), 0xFFFF);
		LSM6DSL_present = DISABLE;
	}
	//caratteri utilizzati frequentemente nell'output (debug)
	char buffer[200];
	char *newline = "\n\r";
	char *tab = "\t";
	char *virgola = ",";
	char *openGraffa = "{";
	char *closeGraffa = "}";



	HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
	HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);

	__HAL_RCC_TIM5_CLK_ENABLE();
	__HAL_RCC_TIM4_CLK_ENABLE();
	float training_time=0;
	float sample_time=0;
	const float scaling_time_factor = 15377;




//	char *sep="#################";
//	char *media="media: ";

	//liste contenenti i neuroni divisi per livello
	InputNode inputNodes[nOfFeatures];
	HiddenNode hiddenNodes[nOfHiddenNodes];
	OutputNode outputNodes[nOfOutputNodes];

	//valori che decidono il funzionamento del dispositivo
	//tipo di funzionamento
	//int mode = WORK_MODE_TRAIN_FROM_DATA_IN_PROGRAM;//WORK_MODE_RANDOM_SETUP  WORK_MODE_TRAIN_FROM_DATA_IN_PROGRAM WORK_MODE_LOAD_NETWORK_FROM_FUNCTION
	//abilitazione del crosstrain
	//int ct = CROSSTRAIN_ENABLED;
	//training che assicura l'utilizzo di ogni elemento del training set o training random
	//int tr_mode = TRAINING_MODE_FULL;
	//mostrare i dati letti dal sensore ad ogni ciclo
	int show_sens_data = NOT_SHOW_SENS_DATA;

	int dist_type;
	int vote_type;
	int cross_train;

	int indexes[nOfSamples]={0};

	int program_mode=6;
	/*
	 * 0 = kNN, distanza euclidea, voto maggioranza
	 * 1 = kNN, distanza euclidea, voto pesato
	 * 2 = kNN, distanza Manhattan, voto maggioranza
	 * 3 = kNN, distanza Manhattan, voto maggioranza
	 * 4 = NN, no crosstrain
	 * 5 = NN con crosstrain
	 * 6 = Perceptron class
	 * */

	switch (program_mode)
	{
		case 0:
		{
			dist_type=EUCLIDEAN_DISTANCE;
			vote_type=VOTE_MAJORITY;
			for(int i = 0;i<nOfSamples;i++)
			{
				indexes[i]=i;
			}
			break;
		}
		case 1:
		{
			dist_type=EUCLIDEAN_DISTANCE;
			vote_type=VOTE_WEIGHTED;
			for(int i = 0;i<nOfSamples;i++)
			{
				indexes[i]=i;
			}
			break;
		}
		case 2:
		{
			dist_type=MANHATTAN_DISTANCE;
			vote_type=VOTE_MAJORITY;
			for(int i = 0;i<nOfSamples;i++)
			{
				indexes[i]=i;
			}
			break;
		}
		case 3:
		{
			dist_type=MANHATTAN_DISTANCE;
			vote_type=VOTE_WEIGHTED;
			for(int i = 0;i<nOfSamples;i++)
			{
				indexes[i]=i;
			}
			break;
		}
		case 4:
		{
			randomSetupNodes(inputNodes, hiddenNodes, outputNodes);
			cross_train=CROSSTRAIN_DISABLED;
			break;
		}
		case 5:
		{
			randomSetupNodes(inputNodes, hiddenNodes, outputNodes);
			cross_train=CROSSTRAIN_ENABLED;
			break;
		}
	}




	//generazione di un seed per il generatore di numeri casuali tramite funzione apposita
	int seed = Rand_value_acc();
	srand(seed);

	//perceptron
	float bias=0;
	float w[nOfFeatures]={0};

	//training set
	float trainingSetFeatures[nOfSamples][nOfFeatures] =
	{
			/*
			{0.021725,      0.031302,       1.028945,       -1.113525,      -3.755325,      -14.811301,     0.040323,       0.075775,       0.056705,       1.135966,       3.787384,       15.840349,      -1.000000,      0.260084,       -1.000000,      },
			{0.021322,      0.033197,       1.032046,       1.372700,       -2.085125,      18.608095,      0.026683,       0.039839,       0.033599,       1.351642,       2.118697,       17.576080,      1.000000,       -1.000000,      -1.000000,      },
			{0.017691,      0.032962,       1.030418,       1.002400,       -2.020725,      15.943550,      0.020326,       0.032759,       0.038411,       0.984918,       2.053948,       14.913181,      1.000000,       0.685874,       -1.000000,      },
			{0.008926,      0.019439,       1.034458,       -0.425600,      -2.385775,      7.916300,       0.019576,       0.034892,       0.037047,       0.434966,       2.405467,       6.881943,       0.089293,       -0.566571,      -1.000000,      },
			{0.019313,      0.010069,       1.028721,       -0.526225,      -3.298575,      -17.014898,     0.032603,       0.027594,       0.016303,       0.546511,       3.308758,       18.043629,      -1.000000,      0.039119,       -0.194879,      },
			{0.003765,      0.025283,       1.025271,       -0.003500,      -2.548000,      -5.303375,      0.024230,       0.031880,       0.033399,       0.025296,       2.573481,       6.328734,       -1.000000,      0.763298,       -1.000000,      },
			{0.004092,      0.015110,       1.034320,       0.134925,       -2.551675,      5.946326,       0.034534,       0.032306,       0.023197,       0.135314,       2.566988,       4.912061,       -0.390024,      0.521044,       1.000000,       },
			{0.014397,      0.023203,       1.032365,       -0.205975,      -3.009650,      -4.269650,      0.021975,       0.033525,       0.039113,       0.221465,       3.033039,       5.302160,       -1.000000,      -0.302425,      -1.000000,      },
			{0.015278,      0.020100,       1.030149,       -0.273175,      -2.912000,      -13.206373,     0.030160,       0.028272,       0.022635,       0.290025,       2.932236,       14.236540,      -1.000000,      1.000000,       -1.000000,      },
			{-0.003558,     0.037790,       1.033655,       -0.205975,      -3.291750,      -13.654202,     0.023031,       0.029634,       0.024130,       0.203723,       3.329671,       14.687878,      0.356312,       -1.000000,      1.000000,       },
			{0.003304,      0.055817,       1.030568,       1.048775,       -1.944075,      19.521425,      0.024911,       0.037541,       0.022935,       1.045768,       2.000245,       18.490871,      1.000000,       0.013443,       1.000000,       },
			{0.011940,      0.021603,       1.032404,       1.063475,       -2.255225,      13.514374,      0.031034,       0.032198,       0.040649,       1.051993,       2.277055,       12.482036,      -0.505897,      -1.000000,      1.000000,       },
			{0.008714,      0.029562,       1.033404,       -0.139125,      -1.881600,      14.251124,      0.023878,       0.031392,       0.036209,       0.149756,       1.911420,       13.217771,      1.000000,       -0.461327,      -1.000000,      },
			{0.024964,      0.021172,       1.025836,       0.021350,       -2.371600,      11.266151,      0.028062,       0.031918,       0.039101,       0.028293,       2.392985,       10.240390,      -1.000000,      0.021169,       -1.000000,      },
			{0.030204,      0.030954,       1.029273,       0.749000,       -2.147425,      8.043700,       0.027266,       0.025213,       0.026640,       0.719314,       2.178525,       7.014478,       0.308678,       0.683120,       -1.000000,      },
			{0.005921,      0.014822,       1.032236,       0.396375,       -2.309300,      18.108124,      0.026869,       0.029090,       0.020606,       0.391378,       2.324304,       17.075901,      -1.000000,      0.102508,       -0.681946,      },
			{0.006461,      0.017905,       1.033492,       -0.466550,      -3.711575,      -22.421873,     0.026396,       0.028536,       0.026271,       0.473747,       3.729589,       23.455379,      -1.000000,      -0.140334,      1.000000,       },
			{0.006063,      0.013884,       1.030136,       0.499800,       -2.988650,      -5.634122,      0.027585,       0.034616,       0.037812,       0.494506,       3.002733,       6.664366,       -0.469521,      -0.773704,      -1.000000,      },
			{0.008489,      0.021487,       1.034012,       0.811300,       -3.273026,      -9.663674,      0.026521,       0.040902,       0.033873,       0.803249,       3.294766,       10.697740,      1.000000,       1.000000,       1.000000,       },
			{0.053646,      -0.001266,      1.027898,       1.763825,       -2.550100,      19.034399,      0.033840,       0.029039,       0.022731,       1.710514,       2.548999,       18.006516,      1.000000,       0.784308,       -1.000000,      },
			{0.028763,      0.000389,       1.026823,       -0.026250,      -2.982874,      -4.167276,      0.027632,       0.031501,       0.026002,       0.061563,       2.983430,       5.194164,       0.700046,       0.550659,       1.000000,       },
			{0.016342,      0.006620,       1.025932,       0.865550,       -2.861425,      7.340024,       0.028173,       0.031140,       0.034110,       0.849675,       2.868214,       6.314185,       1.000000,       0.271175,       -1.000000,      },
			{0.013177,      0.010185,       1.032176,       -0.500325,      -3.416175,      -1.676674,      0.035112,       0.042195,       0.035133,       0.514701,       3.426620,       2.709078,       -1.000000,      -0.337130,      -1.000000,      },
			{0.010704,      -0.007491,      1.029544,       0.609175,       -2.930550,      11.319348,      0.041544,       0.047169,       0.046473,       0.599911,       2.923440,       10.289909,      -0.640926,      -1.000000,      1.000000,       },
			{0.030238,      0.000049,       1.023267,       1.073275,       -2.933000,      7.211576,       0.032654,       0.047324,       0.061974,       1.043548,       2.933430,       6.188620,       1.000000,       1.000000,       -1.000000,      },
			{0.014999,      -0.013560,      1.029665,       -0.123200,      -3.649274,      -19.504976,     0.032950,       0.037142,       0.040589,       0.142072,       3.635904,       20.534681,      -1.000000,      -1.000000,      1.000000,       },
			{0.012765,      -0.008751,      1.030456,       -1.286950,      -3.173275,      -14.879897,     0.025165,       0.046439,       0.055382,       1.299959,       3.164865,       15.910449,      -1.000000,      1.000000,       -1.000000,      },
			{0.020902,      -0.012271,      1.027484,       0.872550,       -2.867900,      10.763900,      0.027330,       0.032997,       0.042969,       0.852086,       2.855820,       9.736510,       -0.035325,      -1.000000,      -1.000000,      },
			{0.018817,      -0.005079,      1.037279,       1.045450,       -1.984675,      8.576925,       0.035918,       0.038614,       0.036185,       1.027261,       1.979973,       7.539733,       -1.000000,      -1.000000,      1.000000,       },
			{0.007000,      0.028594,       1.029514,       1.385825,       -2.418324,      6.016850,       0.038255,       0.045562,       0.050013,       1.379355,       2.447343,       4.987586,       -1.000000,      -1.000000,      -1.000000,      },
			{0.005017,      0.007336,       1.024844,       0.816550,       -2.520350,      10.875550,      0.032297,       0.039237,       0.045016,       0.812176,       2.527990,       9.850810,       1.000000,       -1.000000,      -1.000000,      },
			{0.014430,      -0.010787,      1.031287,       0.718900,       -2.970275,      12.739998,      0.037896,       0.028228,       0.024603,       0.705488,       2.959622,       11.708737,      -1.000000,      1.000000,       1.000000,       },
			{0.006738,      0.002307,       1.031538,       -0.486500,      -2.626225,      -3.272326,      0.027010,       0.027764,       0.034285,       0.493977,       2.628679,       4.303999,       0.979960,       0.410584,       -1.000000,      },
			{0.018749,      -0.000035,      1.031117,       -0.607600,      -2.776375,      -15.600373,     0.029224,       0.027425,       0.030569,       0.627030,       2.776474,       16.631517,      -1.000000,      0.397869,       1.000000,       },
			{0.016346,      0.005396,       1.026393,       0.736400,       -2.442650,      19.910101,      0.027082,       0.030803,       0.027280,       0.720563,       2.448240,       18.883728,      1.000000,       0.357930,       -1.000000,      },
			{0.010898,      -0.008552,      1.039368,       0.915250,       -2.570050,      12.932673,      0.030681,       0.028788,       0.030599,       0.904872,       2.561660,       11.893343,      0.149985,       -1.000000,      1.000000,       },
			{0.027832,      0.001900,       1.027584,       -1.114575,      -2.942275,      -15.523203,     0.026896,       0.035266,       0.032714,       1.142723,       2.944386,       16.550819,      1.000000,       -1.000000,      1.000000,       },
			{0.011318,      -0.006598,      1.025717,       -0.187775,      -2.875600,      -12.618901,     0.025909,       0.039624,       0.042932,       0.200772,       2.869276,       13.644687,      1.000000,       1.000000,       -1.000000,      },
			{0.012288,      -0.015928,      1.028171,       0.498050,       -2.425325,      24.889027,      0.029603,       0.030049,       0.036021,       0.486663,       2.409584,       23.860882,      1.000000,       0.008229,       -1.000000,      },
			{0.011384,      0.009301,       1.030138,       0.048125,       -2.602075,      -3.459749,      0.029222,       0.032829,       0.038749,       0.046945,       2.611582,       4.490054,       1.000000,       1.000000,       -0.314905,      },
			{0.012666,      0.011117,       1.033967,       0.624400,       -3.471825,      -7.221200,      0.037511,       0.036214,       0.030086,       0.612883,       3.483130,       8.255221,       -0.567043,      0.345762,       1.000000,       },
			{0.017975,      0.010393,       1.034694,       -0.509250,      -2.875250,      -4.389175,      0.033654,       0.034457,       0.033870,       0.528298,       2.885849,       5.423975,       -1.000000,      0.012546,       -1.000000,      },
			{0.014614,      0.016537,       1.030295,       -0.051800,      -3.122525,      -5.481001,      0.025591,       0.025692,       0.028602,       0.071174,       3.139167,       6.511358,       -1.000000,      -1.000000,      1.000000,       },
			{0.040007,      0.018692,       1.031167,       0.550900,       -2.121525,      4.959679,       0.037880,       0.035698,       0.027719,       0.512295,       2.140514,       3.928609,       -1.000000,      -1.000000,      1.000000,       },
			{0.011001,      -0.020052,      1.033409,       0.736575,       -2.477300,      20.385574,      0.029290,       0.033054,       0.036563,       0.726165,       2.457470,       19.352198,      0.218454,       0.274164,       -1.000000,      },
			{0.011192,      -0.023232,      1.028757,       1.453375,       -3.050600,      10.153324,      0.025883,       0.038991,       0.038978,       1.442415,       3.027619,       9.124651,       1.000000,       0.974177,       1.000000,       },
			{0.012952,      -0.043125,      1.029005,       -0.398300,      -2.575300,      -0.998724,      0.042177,       0.041925,       0.035359,       0.413409,       2.532522,       2.028038,       -1.000000,      1.000000,       -1.000000,      },
			{0.016321,      -0.035642,      1.027235,       -0.935375,      -2.498825,      -12.026532,     0.033571,       0.033227,       0.025229,       0.952288,       2.463407,       13.053792,      0.547361,       1.000000,       -1.000000,      },
			{0.007932,      -0.027193,      1.029602,       -1.435175,      -2.762025,      -11.477549,     0.029596,       0.031415,       0.025712,       1.443411,       2.735013,       12.507178,      -1.000000,      1.000000,       1.000000,       },
			{0.009255,      -0.022820,      1.036716,       0.287350,       -2.878225,      13.587700,      0.028874,       0.032805,       0.041227,       0.279590,       2.855593,       12.551050,      0.629501,       0.113542,       1.000000,       },

			{-0.070892,     0.030600,       1.015728,       -0.467775,      -1.473850,      -12.533501,     0.169800,       0.082487,       0.157351,       0.431681,       1.506710,       13.550142,      -1.000000,      1.000000,       -1.000000,      },
			{-0.039734,     0.023456,       1.030240,       -6.470274,      13.517176,      28.494902,      0.177771,       0.112166,       0.118330,       6.432997,       13.494186,      27.464914,      -1.000000,      1.000000,       1.000000,       },
			{-0.022288,     0.105047,       1.009489,       2.791250,       -3.523451,      1.502550,       0.157854,       0.118209,       0.108205,       2.817963,       3.630422,       0.504794,       -1.000000,      1.000000,       1.000000,       },
			{-0.014780,     0.001757,       1.008447,       2.866499,       -0.777350,      14.321302,      0.176340,       0.088658,       0.139596,       2.886671,       0.784135,       13.313589,      -1.000000,      1.000000,       1.000000,       },
			{-0.010921,     -0.077798,      1.003122,       -1.420300,      -1.398075,      7.936953,       0.190659,       0.156279,       0.150966,       1.422216,       1.329494,       6.935474,       -1.000000,      1.000000,       -1.000000,      },
			{-0.032096,     -0.011452,      1.001663,       0.960225,       -2.836050,      3.347751,       0.214026,       0.164690,       0.146988,       1.015139,       2.829395,       2.350689,       1.000000,       1.000000,       -1.000000,      },
			{0.027222,      -0.113471,      0.994001,       -0.131075,      -3.680251,      9.463299,       0.203274,       0.125220,       0.145894,       0.257640,       3.568977,       8.470554,       -1.000000,      1.000000,       -1.000000,      },
			{-0.006557,     -0.119933,      1.003740,       2.595600,       -4.607750,      -9.425675,      0.192825,       0.151016,       0.110863,       2.609292,       4.490357,       10.430005,      -1.000000,      1.000000,       1.000000,       },
			{-0.010702,     0.044797,       1.000074,       -0.157500,      -4.290300,      -12.104223,     0.170567,       0.151064,       0.105466,       0.225039,       4.337729,       13.104722,      -1.000000,      1.000000,       1.000000,       },
			{-0.143407,     0.020625,       1.002201,       0.908075,       -0.586075,      -14.083824,     0.119584,       0.166188,       0.110194,       1.058260,       0.629050,       15.086428,      1.000000,       -1.000000,      -1.000000,      },
			{0.008586,      -0.100019,      1.000516,       5.337325,       -0.548275,      -11.663225,     0.185992,       0.113124,       0.100656,       5.331984,       0.462310,       12.664141,      -1.000000,      1.000000,       -1.000000,      },
			{-0.125813,     -0.118445,      0.994134,       0.623875,       -4.163600,      10.991925,      0.184425,       0.136338,       0.077645,       0.772038,       4.047452,       9.998092,       -1.000000,      -1.000000,      -1.000000,      },
			{-0.017031,     -0.043536,      0.987940,       5.546625,       -1.959300,      1.915025,       0.265248,       0.090862,       0.119130,       5.569976,       1.917917,       0.934708,       1.000000,       -1.000000,      1.000000,       },
			{-0.025250,     -0.027969,      0.984685,       1.069775,       -5.268725,      -12.589325,     0.198675,       0.206127,       0.127966,       1.112903,       5.244808,       13.574613,      -1.000000,      -1.000000,      -1.000000,      },
			{0.006730,      -0.112695,      1.016619,       0.447300,       -5.656701,      8.341375,       0.255223,       0.093653,       0.109968,       0.509157,       5.544796,       7.325583,       1.000000,       1.000000,       1.000000,       },
			{0.158307,      -0.066351,      0.994257,       -2.419025,      -7.323925,      -7.212625,      0.194393,       0.092301,       0.112857,       2.584653,       7.258161,       8.207658,       -1.000000,      1.000000,       1.000000,       },
			{-0.016126,     0.003897,       1.012296,       2.855125,       -3.252550,      4.666900,       0.157431,       0.091294,       0.091459,       2.875563,       3.257726,       3.655748,       1.000000,       1.000000,       -1.000000,      },
			{-0.049897,     -0.045096,      0.984035,       -0.158550,      -2.740500,      20.139870,      0.251139,       0.180226,       0.127370,       0.273636,       2.701423,       19.156258,      1.000000,       1.000000,       1.000000,       },
			{-0.001806,     -0.036153,      0.995082,       -3.154551,      -3.132850,      1.701525,       0.284509,       0.105716,       0.141674,       3.165556,       3.098500,       0.720509,       1.000000,       1.000000,       -1.000000,      },
			{-0.004634,     -0.048352,      0.988734,       1.360099,       -3.797324,      -3.514175,      0.222317,       0.207322,       0.107851,       1.382722,       3.754700,       4.504200,       1.000000,       1.000000,       0.910333,       },
			{0.115461,      -0.051920,      0.995577,       -0.396900,      -2.034025,      -0.568050,      0.218181,       0.130809,       0.120923,       0.556881,       1.986417,       1.568296,       -1.000000,      1.000000,       1.000000,       },
			{-0.042599,     -0.013357,      0.999814,       5.398926,       -7.625100,      19.492725,      0.269985,       0.127145,       0.127088,       5.448218,       7.612806,       18.493347,      1.000000,       1.000000,       1.000000,       },
			{0.013763,      0.057479,       0.974407,       2.408700,       -1.410676,      22.894726,      0.273731,       0.228344,       0.146784,       2.410529,       1.485806,       21.920809,      1.000000,       -1.000000,      1.000000,       },
			{-0.043018,     0.033053,       0.974385,       -2.452450,      -5.108249,      -3.637725,      0.285093,       0.161200,       0.106898,       2.426239,       5.143829,       4.613348,       1.000000,       1.000000,       -1.000000,      },
			{-0.006246,     0.078847,       0.989651,       2.632175,       -1.095500,      4.424700,       0.216044,       0.201683,       0.118780,       2.647251,       1.191540,       3.437103,       -1.000000,      -1.000000,      1.000000,       },
			{0.004698,      0.080973,       0.997319,       -1.201025,      -3.962874,      3.698624,       0.259517,       0.122379,       0.140329,       1.233336,       4.045698,       2.704947,       -1.000000,      1.000000,       1.000000,       },
			{0.041861,      -0.101411,      0.990359,       -2.197825,      -2.259600,      -12.745423,     0.269350,       0.120374,       0.126257,       2.255824,       2.161544,       13.736362,      -1.000000,      -1.000000,      1.000000,       },
			{-0.089558,     -0.105840,      0.984524,       -1.881075,      -1.915375,      1.682800,       0.281113,       0.127219,       0.153754,       1.813439,       1.814002,       0.715003,       1.000000,       1.000000,       -1.000000,      },
			{0.075030,      -0.035439,      1.004349,       -0.146125,      -1.382675,      2.787399,       0.187614,       0.119880,       0.124915,       0.290015,       1.352559,       1.787420,       -1.000000,      -1.000000,      1.000000,       },
			{-0.007591,     -0.162691,      0.992115,       2.895899,       -0.895651,      -31.768274,     0.226853,       0.134666,       0.136731,       2.912339,       0.745228,       32.760670,      -1.000000,      1.000000,       -1.000000,      },
			{0.085157,      -0.081040,      0.998314,       -1.177575,      -1.165676,      -6.119575,      0.215016,       0.142443,       0.126769,       1.280908,       1.093949,       7.119018,       -1.000000,      -1.000000,      1.000000,       },
			{-0.049111,     -0.322662,      0.981618,       0.638050,       -7.208776,      7.016100,       0.158481,       0.107669,       0.111296,       0.705200,       6.886956,       6.035508,       1.000000,       -1.000000,      -1.000000,      },
			{-0.003521,     -0.196017,      0.979915,       0.152075,       0.293476,       8.110201,       0.184713,       0.277952,       0.166640,       0.241514,       0.562904,       7.132233,       1.000000,       1.000000,       1.000000,       },
			{-0.185669,     -0.195377,      0.986191,       -0.648025,      -5.881751,      1.266476,       0.150320,       0.161201,       0.125610,       0.486178,       5.688658,       0.307144,       1.000000,       1.000000,       -1.000000,      },
			{0.067188,      -0.184386,      0.985426,       3.648925,       -0.440300,      -11.310426,     0.215975,       0.134225,       0.108386,       3.588242,       0.288978,       12.296329,      -1.000000,      1.000000,       1.000000,       },
			{-0.096207,     -0.304573,      0.969992,       4.957225,       -2.507050,      -3.468850,      0.203364,       0.150017,       0.160884,       5.057522,       2.207580,       4.441756,       1.000000,       1.000000,       1.000000,       },
			{-0.076291,     -0.142311,      1.007787,       1.096550,       -2.949275,      -4.266674,      0.200913,       0.090679,       0.105700,       1.189926,       2.808429,       5.275520,       -1.000000,      1.000000,       1.000000,       },
			{-0.100812,     0.027698,       0.982346,       1.276800,       -0.874475,      18.193001,      0.201994,       0.258474,       0.106158,       1.392342,       0.938469,       17.210981,      1.000000,       1.000000,       -1.000000,      },
			{0.018400,      -0.146879,      1.023109,       -0.697375,      -3.840725,      4.150649,       0.116711,       0.115311,       0.159743,       0.725228,       3.695645,       3.131617,       1.000000,       1.000000,       -1.000000,      },
			{-0.030717,     -0.192704,      1.017565,       0.465850,       -7.004725,      3.795575,       0.111798,       0.180118,       0.162603,       0.508997,       6.814402,       2.782764,       1.000000,       1.000000,       -1.000000,      },
			{-0.030294,     -0.147104,      1.011971,       -4.148376,      -4.115125,      -13.924228,     0.210584,       0.136806,       0.134995,       4.123463,       3.970379,       14.936809,      1.000000,       1.000000,       1.000000,       },
			{-0.061742,     -0.137660,      0.967189,       1.791650,       2.137799,       -15.520752,     0.228701,       0.235015,       0.107353,       1.867449,       2.287563,       16.488291,      1.000000,       -1.000000,      1.000000,       },
			{-0.028415,     -0.005846,      0.994094,       1.068025,       -0.055825,      3.606225,       0.162204,       0.250345,       0.093759,       1.108373,       0.255285,       2.613814,       -1.000000,      -1.000000,      1.000000,       },
			{0.104292,      -0.115283,      0.996791,       -2.757300,      0.325850,       -3.165050,      0.198679,       0.126007,       0.089679,       2.868481,       0.458776,       4.162807,       -1.000000,      -1.000000,      1.000000,       },
			{-0.176530,     0.042445,       0.999373,       4.442899,       -4.437125,      -23.339397,     0.147187,       0.153472,       0.079574,       4.621774,       4.482198,       24.338903,      -1.000000,      -1.000000,      1.000000,       },
			{0.038558,      -0.163794,      0.991149,       -2.839551,      3.616200,       -23.903599,     0.209207,       0.138077,       0.086289,       2.885702,       3.782514,       24.894899,      -1.000000,      1.000000,       1.000000,       },
			{-0.179684,     0.012335,       0.976039,       0.704025,       -4.488050,      -2.862125,      0.229205,       0.200909,       0.102800,       0.912949,       4.504869,       3.839540,       1.000000,       1.000000,       -1.000000,      },
			{0.116545,      -0.142989,      0.997251,       -5.531924,      -1.104425,      -16.431623,     0.228091,       0.152278,       0.105440,       5.653073,       0.973421,       17.429195,      -1.000000,      -1.000000,      1.000000,       },
			{0.073593,      -0.009133,      1.024385,       -0.308175,      0.053550,       -16.725628,     0.139869,       0.121507,       0.116396,       0.406583,       0.136723,       17.750393,      -1.000000,      -1.000000,      -1.000000,      },
			{-0.030099,     -0.026256,      0.990094,       0.522725,       -7.131950,      -3.076150,      0.264366,       0.146813,       0.124320,       0.612784,       7.107211,       4.068144,       1.000000,       1.000000,       -1.000000,      }
	*/

			{-0.007917,     0.020740,       1.025343,       -0.446075,      -3.286500,      19.426748,      0.051920,       0.068200,       0.048657,       0.441224,       3.307944,       18.401470,      0.248966,       0.106213,       0.014841,       },
			{-0.002090,     0.001429,       1.027824,       1.580950,       -3.114300,      15.665123,      0.031962,       0.041332,       0.068772,       1.583362,       3.116003,       14.637459,      0.112833,       0.036403,       -0.040866,      },
			{0.018592,      -0.007006,      1.028243,       -0.180950,      -3.881325,      -11.733397,     0.020671,       0.056826,       0.080953,       0.200609,       3.874736,       12.761897,      0.143084,       0.388142,       0.033596,       },
			{-0.004713,     -0.070449,      1.031026,       -0.361900,      -2.077950,      -17.959026,     0.037888,       0.048424,       0.060819,       0.359191,       2.008085,       18.990150,      -0.127013,      -0.110821,      -0.021026,      },
			{0.031875,      -0.054871,      1.027959,       0.256550,       -3.425975,      -8.542276,      0.041352,       0.044707,       0.032226,       0.228449,       3.371401,       9.570289,       -0.301237,      -0.003063,      0.046571,       },
			{0.022181,      -0.036007,      1.029285,       0.357700,       -2.823975,      -21.056875,     0.028343,       0.046389,       0.051452,       0.336714,       2.788354,       22.086220,      -0.246014,      -0.071237,      -0.007140,      },
			{0.000856,      -0.029775,      1.028719,       1.216950,       -3.349675,      26.090925,      0.038105,       0.046773,       0.036913,       1.216690,       3.320229,       25.062233,      -0.082007,      0.060927,       -0.009829,      },
			{0.010217,      -0.051928,      1.028427,       0.628775,       -3.150350,      3.713325,       0.050591,       0.039661,       0.043569,       0.620623,       3.098676,       2.685251,       -0.189830,      0.057025,       -0.002101,      },
			{0.025514,      -0.031398,      1.029422,       0.429975,       -3.279150,      -8.547176,      0.025346,       0.038501,       0.053071,       0.405254,       3.247980,       9.576747,       -0.193196,      -0.098189,      0.049795,       },
			{0.024690,      -0.009362,      1.029547,       1.062075,       -4.116875,      5.231450,       0.031263,       0.043768,       0.051911,       1.037856,       4.107746,       4.202224,       0.020958,       0.020697,       0.008408,       },
			{0.030051,      -0.014024,      1.028716,       2.559550,       -2.286025,      30.158096,      0.043487,       0.047216,       0.032605,       2.529873,       2.272491,       29.129402,      -0.422354,      0.179097,       0.122743,       },
			{0.027490,      -0.002285,      1.029819,       -0.578200,      -4.024651,      -7.690021,      0.043672,       0.052993,       0.041384,       0.607263,       4.022715,       8.719938,       -0.169688,      -0.093082,      0.119389,       },
			{0.009999,      0.007016,       1.035007,       1.072750,       -2.185225,      20.773901,      0.030032,       0.052107,       0.065319,       1.063175,       2.192860,       19.739002,      0.056562,       -0.112032,      -0.013166,      },
			{0.050090,      -0.000711,      1.029366,       -0.576275,      -4.209275,      -23.785650,     0.029865,       0.046979,       0.058229,       0.627076,       4.208826,       24.815084,      -0.310422,      -0.249962,      0.044857,       },
			{0.024373,      0.002540,       1.027723,       -0.846475,      -3.172925,      -18.364325,     0.043821,       0.041657,       0.034936,       0.871950,       3.175739,       19.392080,      0.034085,       0.007610,       0.116236,       },
			{0.007331,      0.003344,       1.027926,       0.847000,       -3.097325,      11.763846,      0.038327,       0.041325,       0.047596,       0.840543,       3.100944,       10.736027,      -0.123517,      -0.005513,      0.088983,       },
			{0.029408,      -0.013810,      1.028518,       1.954400,       -3.046225,      18.943050,      0.038923,       0.038012,       0.042269,       1.925385,       3.032653,       17.914579,      -0.287103,      0.236621,       0.030272,       },
			{0.042383,      0.025413,       1.025952,       0.936250,       -2.920050,      12.412577,      0.022729,       0.040352,       0.060601,       0.894156,       2.945739,       11.386786,      -0.101945,      0.347698,       0.110330,       },
			{0.049498,      -0.011738,      1.028249,       -1.700825,      -3.785250,      -25.773827,     0.025882,       0.049607,       0.065048,       1.750515,       3.773838,       26.802155,      0.135834,       0.222622,       0.083520,       },
			{0.010270,      0.011747,       1.028952,       -0.391125,      -4.249350,      -14.254272,     0.039101,       0.038283,       0.045341,       0.403295,       4.261270,       15.283291,      0.080445,       0.187735,       0.003076,       },
			{0.033221,      0.013827,       1.028516,       0.431900,       -2.899050,      9.285502,       0.035039,       0.059417,       0.072891,       0.400216,       2.913484,       8.257308,       -0.002878,      0.425850,       0.013613,       },
			{0.055867,      -0.007063,      1.029440,       -0.340550,      -3.994900,      -29.941452,     0.034644,       0.065285,       0.075215,       0.397928,       3.988372,       30.970984,      -0.137789,      0.214078,       0.037508,       },
			{0.068540,      -0.007496,      1.026905,       1.030050,       -4.066651,      -2.894153,      0.029500,       0.076833,       0.050099,       0.961963,       4.059882,       3.921378,       0.221535,       -0.188692,      -0.027616,      },
			{0.027726,      0.009756,       1.032265,       3.824275,       -1.930250,      33.265400,      0.033190,       0.039456,       0.036757,       3.796695,       1.940408,       32.233154,      -0.152863,      -0.175722,      -0.065062,      },
			{0.028803,      0.013471,       1.026614,       0.748300,       -2.520700,      15.321250,      0.033145,       0.035048,       0.060294,       0.720260,       2.534414,       14.294763,      -0.102514,      -0.051346,      -0.030603,      },
			{0.016411,      0.028517,       1.029967,       1.037050,       -2.589125,      15.852900,      0.031712,       0.042300,       0.054404,       1.021131,       2.617985,       14.823031,      -0.156475,      0.162911,       -0.096598,      },
			{0.035220,      0.010573,       1.028473,       -0.587475,      -4.138400,      -19.167227,     0.021273,       0.054001,       0.073366,       0.623058,       4.149324,       20.195831,      -0.243176,      0.218326,       0.130778,       },
			{0.013156,      0.001793,       1.032276,       -0.236075,      -3.875725,      -25.341225,     0.039966,       0.044735,       0.048991,       0.252415,       3.877776,       26.373547,      -0.057818,      0.411249,       0.016677,       },
			{0.031959,      0.004494,       1.030584,       0.137550,       -3.416700,      -9.721777,      0.044851,       0.038823,       0.038962,       0.114721,       3.421415,       10.752431,      -0.377762,      0.015835,       0.081865,       },
			{-0.006495,     0.031548,       1.029867,       -0.470575,      -4.928875,      -27.467651,     0.033474,       0.043517,       0.059057,       0.465286,       4.960614,       28.497580,      0.130567,       0.109591,       0.028753,       },
			{0.013714,      0.020511,       1.033436,       0.282975,       -2.923550,      8.779400,       0.028193,       0.046607,       0.063092,       0.270733,       2.944430,       7.746220,       -0.058708,      0.148672,       -0.037508,      },
			{0.009694,      0.045433,       1.026150,       1.605450,       -1.150275,      27.032070,      0.052940,       0.042259,       0.032608,       1.596634,       1.196454,       26.005941,      -0.160128,      -0.152336,      0.085245,       },
			{0.034116,      0.033551,       1.027815,       0.448175,       -4.837875,      -25.173220,     0.031494,       0.041472,       0.062548,       0.415255,       4.871603,       26.201107,      -0.088370,      0.269326,       -0.050441,      },
			{0.031632,      0.052207,       1.028209,       -1.455825,      -5.633775,      -36.236725,     0.031978,       0.041664,       0.041642,       1.487800,       5.686136,       37.264957,      0.128826,       0.304295,       0.242225,       },
			{0.018872,      0.038399,       1.031061,       0.605850,       -2.901500,      9.385250,       0.021121,       0.041278,       0.065878,       0.587358,       2.940190,       8.354448,       0.118389,       0.040828,       -0.038903,      },
			{0.028275,      0.040769,       1.028820,       -0.372925,      -4.836125,      -20.262377,     0.019767,       0.040404,       0.054931,       0.401686,       4.877061,       21.291267,      -0.041755,      0.342877,       0.043960,       },
			{0.055782,      0.008835,       1.028045,       -1.789375,      -4.596725,      -37.094398,     0.039202,       0.036322,       0.039148,       1.845573,       4.605703,       38.122467,      -0.262531,      -0.288497,      0.124980,       },
			{0.020657,      0.016864,       1.032105,       2.489375,       -2.155475,      35.674271,      0.032678,       0.039844,       0.037068,       2.468934,       2.172705,       34.642185,      0.031276,       0.195330,       -0.025590,      },
			{0.029348,      0.032178,       1.030629,       3.712975,       -1.330350,      38.643322,      0.027224,       0.039669,       0.042596,       3.683727,       1.363105,       37.612720,      -0.118187,      -0.202201,      0.091257,       },
			{0.031482,      0.042374,       1.026784,       2.219700,       -2.175075,      17.771425,      0.031833,       0.044547,       0.064635,       2.188450,       2.217897,       16.744766,      -0.124347,      0.195213,       0.072489,       },
			{0.043101,      0.045190,       1.025683,       -0.254275,      -4.534950,      -19.437075,     0.023712,       0.049841,       0.066584,       0.298320,       4.580412,       20.462868,      -0.248925,      0.115003,       0.121689,       },
			{0.043383,      0.038911,       1.027742,       1.294825,       -3.397275,      9.198523,       0.038821,       0.039418,       0.046057,       1.252044,       3.436411,       8.170911,       -0.409838,      -0.287380,      0.110871,       },
			{0.033317,      0.010149,       1.025155,       -0.618975,      -2.441950,      -8.408225,      0.035466,       0.039788,       0.031668,       0.653256,       2.452422,       9.433434,       -0.265578,      0.027490,       0.018908,       },
			{0.047868,      0.028494,       1.027787,       0.201425,       -4.353650,      -17.672369,     0.027332,       0.061571,       0.034645,       0.155971,       4.382577,       18.700190,      0.124570,       0.172318,       0.011875,       },
			{0.028210,      0.013180,       1.032066,       0.371175,       -3.448725,      -3.319750,      0.034612,       0.042365,       0.061468,       0.344707,       3.462164,       4.352251,       -0.132511,      -0.024189,      -0.014803,      },
			{0.026642,      -0.002738,      1.030550,       0.607775,       -3.331825,      12.428327,      0.030115,       0.043226,       0.068453,       0.581912,       3.329368,       11.397983,      -0.244358,      0.205192,       0.082784,       },
			{0.052681,      0.007919,       1.029525,       -1.042125,      -4.442375,      -20.965347,     0.021155,       0.043206,       0.064770,       1.095010,       4.450504,       21.994967,      -0.010269,      0.156673,       0.150254,       },
			{0.045583,      0.000245,       1.027980,       -0.726600,      -3.868375,      -32.156071,     0.027291,       0.035476,       0.037876,       0.772665,       3.868783,       33.184071,      0.044015,       0.213644,       0.115382,       },
			{0.019238,      0.022563,       1.030650,       1.004675,       -3.242225,      -0.375726,      0.041138,       0.039374,       0.044494,       0.986295,       3.265025,       1.407079,       0.030234,       0.105945,       -0.006747,      },
			{0.034297,      0.036427,       1.026468,       2.514050,       -2.263975,      19.650229,      0.027880,       0.035994,       0.061664,       2.479910,       2.300683,       18.623863,      -0.002540,      0.040510,       -0.027074,      },

			{-0.109064,     0.083217,       1.012977,       0.614250,       -1.478050,      31.177998,      0.136991,       0.107706,       0.080674,       0.736172,       1.564978,       30.165129,      0.006381,       0.245339,       -0.052865,      },
			{-0.020047,     0.069635,       1.018848,       -0.639800,      -1.074151,      19.087246,      0.187894,       0.085433,       0.106061,       0.647609,       1.146972,       18.068708,      0.037712,       0.067370,       0.139550,       },
			{0.040115,      0.101205,       0.988316,       0.349825,       -5.361300,      0.835800,       0.229188,       0.147540,       0.156598,       0.385289,       5.464497,       0.218596,       -0.165058,      -0.157273,      0.059216,       },
			{0.017497,      0.030388,       1.010053,       -1.015525,      -4.366425,      3.250974,       0.215576,       0.089205,       0.112402,       1.055276,       4.397717,       2.243739,       -0.151386,      -0.207605,      0.059973,       },
			{0.200031,      0.041546,       0.983054,       -2.297400,      2.427601,       -9.500398,      0.218562,       0.097211,       0.120937,       2.506976,       2.388035,       10.484149,      -0.108010,      0.407293,       0.083880,       },
			{0.116193,      -0.017100,      1.001997,       3.460625,       -3.978274,      -0.635424,      0.232530,       0.071488,       0.113918,       3.352507,       3.961820,       1.641379,       -0.162458,      0.109134,       0.037348,       },
			{0.091079,      -0.071707,      0.994831,       -5.975551,      -2.235099,      -28.918402,     0.244614,       0.110209,       0.100382,       6.071560,       2.166198,       29.913401,      0.339559,       -0.058127,      -0.029826,      },
			{-0.050523,     0.045767,       1.005817,       4.861325,       -2.506700,      -9.169125,      0.232652,       0.117583,       0.141235,       4.917355,       2.555174,       10.175922,      0.319694,       0.417115,       -0.113957,      },
			{0.014346,      -0.050086,      1.012450,       -1.965600,      -7.149976,      3.844754,       0.183119,       0.099157,       0.106076,       1.988397,       7.100583,       2.834290,       0.029939,       -0.375377,      0.045393,       },
			{0.023899,      0.006475,       1.000465,       1.250724,       0.534625,       18.217499,      0.178291,       0.150101,       0.144355,       1.239714,       0.549065,       17.217638,      -0.369996,      -0.049962,      -0.110145,      },
			{0.028510,      0.002596,       0.984709,       3.180450,       0.345975,       -5.283074,      0.252538,       0.133240,       0.127391,       3.162041,       0.368323,       6.269079,       -0.383526,      -0.224745,      0.095148,       },
			{0.091305,      0.036574,       0.982560,       3.515051,       -6.602925,      -35.324974,     0.273743,       0.133228,       0.131173,       3.434672,       6.640836,       36.307770,      -0.466175,      0.166289,       -0.308616,      },
			{-0.117725,     0.041029,       1.017329,       1.593725,       -5.725301,      2.617472,       0.142097,       0.123889,       0.118607,       1.717339,       5.767661,       1.604533,       -0.132806,      0.063007,       -0.085313,      },
			{0.046697,      0.059535,       0.980567,       -2.155125,      -3.223325,      4.262825,       0.283205,       0.100743,       0.123519,       2.219960,       3.284405,       3.284583,       -0.240220,      -0.215838,      -0.100560,      },
			{0.218696,      0.128601,       0.965035,       -1.627675,      -5.274676,      -9.553424,      0.203301,       0.078248,       0.154876,       1.857530,       5.403844,       10.519599,      -0.128006,      0.152528,       -0.035632,      },
			{-0.033799,     -0.055138,      0.991469,       -0.221200,      -2.133425,      -11.362575,     0.285108,       0.072286,       0.115484,       0.341183,       2.079544,       12.354582,      -0.063942,      0.162230,       0.009673,       },
			{-0.084935,     0.010103,       0.977720,       3.469374,       -4.124049,      -22.074507,     0.291907,       0.186659,       0.142056,       3.566276,       4.138364,       23.052664,      -0.173316,      0.247247,       0.173298,       },
			{-0.025629,     -0.014810,      1.012560,       3.152626,       -13.482525,     -67.261429,     0.175853,       0.189892,       0.130609,       3.183116,       13.469053,      68.274117,      -0.563624,      0.003089,       -0.168241,      },
			{0.027036,      0.060259,       0.994928,       -2.368800,      -1.854299,      11.698050,      0.240890,       0.125478,       0.135582,       2.407916,       1.918666,       10.703980,      0.203731,       0.185603,       0.142279,       },
			{0.009672,      -0.035984,      0.991473,       -0.534275,      -2.221800,      -5.905200,      0.273523,       0.074233,       0.136060,       0.608846,       2.187076,       6.898015,       -0.249403,      0.137064,       0.108189,       },
			{-0.081811,     -0.028178,      1.010503,       2.448425,       0.927325,       -14.423152,     0.209587,       0.126576,       0.134947,       2.538902,       0.963851,       15.434244,      0.207966,       0.169478,       0.051708,       },
			{-0.013425,     0.129882,       0.968546,       -4.074000,      -6.817649,      -0.761949,      0.131989,       0.311997,       0.196973,       4.062720,       6.954533,       1.741669,       0.414833,       0.213529,       0.026593,       },
			{-0.001574,     0.061187,       0.989816,       0.692825,       -1.031802,      2.189601,       0.326035,       0.077473,       0.136784,       0.767131,       1.095731,       1.207556,       -0.171259,      0.372541,       0.036438,       },
			{0.066966,      -0.048528,      0.995426,       7.190049,       3.797675,       44.218822,      0.293931,       0.101514,       0.145878,       7.129145,       3.847543,       43.223644,      0.170327,       -0.120910,      0.185983,       },
			{-0.033787,     -0.079190,      1.012187,       5.776051,       -3.402699,      16.869823,      0.200143,       0.092654,       0.183709,       5.813284,       3.324800,       15.858701,      0.164958,       0.193861,       -0.007628,      },
			{-0.041216,     -0.033212,      0.988160,       -1.933050,      -3.431400,      -6.321177,      0.314495,       0.095424,       0.154884,       1.917796,       3.399527,       7.310977,       -0.150966,      0.365209,       0.014709,       },
			{0.003987,      -0.077088,      0.987697,       1.568874,       -2.243675,      -30.223198,     0.318510,       0.072506,       0.134761,       1.596973,       2.167800,       31.211189,      -0.304876,      0.076294,       -0.203817,      },
			{0.129094,      0.224425,       0.957085,       6.425127,       -0.396200,      -7.250601,      0.269084,       0.136767,       0.165385,       6.301780,       0.635516,       8.209352,       -0.018655,      0.425830,       0.098363,       },
			{-0.063028,     0.005790,       1.007559,       -2.569525,      -9.959075,      3.648400,       0.178624,       0.102016,       0.119542,       2.512854,       9.965387,       2.643546,       0.206318,       -0.045100,      -0.003033,      },
			{0.106734,      0.010775,       1.003787,       1.130150,       -0.892500,      4.096050,       0.202689,       0.102451,       0.179284,       1.043294,       0.909066,       3.097457,       -0.063748,      -0.121682,      0.115418,       },
			{-0.137044,     0.013774,       1.010821,       1.772226,       -5.984824,      -16.872801,     0.116642,       0.156256,       0.121878,       1.912830,       6.000633,       17.884035,      0.155666,       0.103018,       -0.143094,      },
			{0.089076,      -0.157275,      0.976648,       0.714350,       2.320675,       -7.370474,      0.259075,       0.107608,       0.139840,       0.676822,       2.480286,       8.348292,       -0.299835,      0.299347,       0.164903,       },
			{0.022946,      -0.066560,      1.012277,       7.831777,       -4.672325,      51.927235,      0.213824,       0.110827,       0.133396,       7.811759,       4.607098,       50.915134,      0.361070,       -0.738540,      0.187067,       },
			{-0.092141,     -0.065852,      0.992504,       -1.652174,      -9.142526,      7.313951,       0.284727,       0.081847,       0.156450,       1.585804,       9.077043,       6.323383,       0.043011,       -0.028351,      0.002123,       },
			{-0.061343,     -0.042447,      1.008165,       5.800724,       3.098725,       0.967750,       0.160463,       0.232667,       0.153149,       5.864263,       3.149777,       0.158392,       0.026041,       0.204901,       -0.049893,      },
			{-0.073671,     0.086764,       0.972258,       -4.347175,      -6.743801,      -4.345776,      0.225119,       0.194342,       0.151699,       4.279429,       6.833328,       5.320197,       -0.248973,      -0.049489,      0.058596,       },
			{0.024725,      -0.047909,      1.018097,       6.189225,       -5.458775,      -24.644550,     0.225996,       0.080181,       0.142344,       6.168642,       5.411459,       25.663044,      -0.394691,      0.314605,       -0.050649,      },
			{-0.163775,     -0.013585,      1.021651,       0.625975,       -6.755875,      -0.379573,      0.121336,       0.087042,       0.120422,       0.799017,       6.742852,       1.406389,       0.214505,       0.158843,       0.056854,       },
			{0.010796,      -0.010437,      1.005020,       4.075750,       -2.217775,      7.475651,       0.222758,       0.101549,       0.145756,       4.071054,       2.209672,       6.472272,       -0.042667,      0.031809,       0.137058,       },
			{0.116970,      -0.059961,      0.990547,       -4.685976,      -4.975949,      -18.851000,     0.201931,       0.162356,       0.164052,       4.807189,       4.918669,       19.842224,      0.124317,       -0.113567,      0.022362,       },
			{-0.094144,     -0.024318,      0.981034,       1.013600,       -8.576574,      -9.914974,      0.315991,       0.076100,       0.133535,       1.151931,       8.552595,       10.896826,      -0.352142,      0.172565,       0.049689,       },
			{-0.064456,     -0.074908,      1.010579,       3.400776,       3.195325,       -22.945999,     0.208880,       0.101847,       0.141467,       3.471522,       3.271818,       23.956995,      -0.189306,      -0.083651,      0.079289,       },
			{0.001460,      -0.075801,      0.994628,       1.357650,       -5.745074,      15.132951,      0.287861,       0.110885,       0.167949,       1.386403,       5.670356,       14.139319,      0.113571,       0.087391,       0.415155,       },
			{-0.150020,     0.287902,       0.955480,       3.327101,       -1.874600,      -5.068701,      0.154184,       0.102839,       0.112370,       3.480538,       2.164945,       6.025229,       0.097145,       -0.231243,      -0.182708,      },
			{0.075844,      -0.027271,      0.997465,       -2.004449,      -0.572075,      -2.712500,      0.187201,       0.079871,       0.130834,       2.088699,       0.550628,       3.712271,       -0.113554,      -0.058931,      -0.065036,      },
			{0.078154,      -0.055078,      0.980089,       3.996650,       -2.288651,      -15.938127,     0.257495,       0.105587,       0.132988,       3.926946,       2.236067,       16.918737,      -0.217958,      -0.081769,      -0.099910,      },
			{-0.111050,     -0.027010,      0.981874,       12.788823,      -6.573174,      -19.966631,     0.280164,       0.101269,       0.127776,       12.902916,      6.546948,       20.948895,      -0.548129,      -0.058914,      0.132148,       },
			{-0.023350,     0.025148,       0.998459,       0.081550,       -6.177149,      13.360900,      0.268494,       0.102820,       0.123280,       0.288259,       6.203149,       12.363055,      0.324944,       -0.245277,      0.147904,       },
			{0.129174,      0.016337,       1.002852,       0.687925,       -7.015225,      -21.557550,     0.146137,       0.148431,       0.124622,       0.577546,       7.033129,       22.560743,      -0.027020,      -0.164663,      -0.006772,      },
			{-0.090554,     0.040578,       1.009946,       1.016575,       -6.050625,      -20.556023,     0.202999,       0.092094,       0.138795,       1.125586,       6.091899,       21.566416,      -0.026591,      0.461094,       -0.059586,      }
	};
	//etichette associate ai vettori di training
	int trainingLabels[nOfSamples] = { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
									   0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };

	//normalizzazione del training set
	float max_values[nOfFeatures] = { 0 };

	for (int i = 0; i < nOfFeatures; i++)
	{
		for (int sample = 0; sample < nOfSamples; sample++)
		{
			float temp_val = fabs(trainingSetFeatures[sample][i]);
			if (temp_val > max_values[i])
			{
				max_values[i] = temp_val;
			}
		}
	}
	for (int i = 0; i < nOfFeatures; i++)
	{
		for (int sample = 0; sample < nOfSamples; sample++)
		{
			trainingSetFeatures[sample][i] = trainingSetFeatures[sample][i]	/ max_values[i];
		}
	}
	float testSet[testSetSize][nOfFeatures] =
	{
			{0.000076,      0.051539,       1.026580,       0.811825,       -2.073750,      23.873154,      0.032569,       0.034500,       0.046827,       0.812403,       2.125569,       22.846622,      0.139387,       0.188922,       -0.071970,      },
			{0.020657,      0.032065,       1.023186,       -0.738675,      -3.702825,      -12.392799,     0.024501,       0.035111,       0.051078,       0.759727,       3.735055,       13.416082,      -0.185072,      0.046337,       0.026347,       },
			{0.029076,      0.001774,       1.026472,       -0.513625,      -4.841900,      -22.183001,     0.028409,       0.043507,       0.043689,       0.543444,       4.843869,       23.209515,      -0.040233,      -0.056066,      0.087465,       },
			{0.049057,      -0.006188,      1.029374,       -1.847650,      -3.910025,      -28.832125,     0.057417,       0.032193,       0.027403,       1.897576,       3.903970,       29.861509,      0.141071,       0.175536,       -0.002127,      },
			{0.017956,      0.020047,       1.024979,       1.160250,       -3.015600,      16.090900,      0.029668,       0.036210,       0.042553,       1.142679,       3.035863,       15.065980,      -0.187418,      -0.204517,      0.029671,       },
			{0.035192,      0.027817,       1.025969,       0.348775,       -2.552200,      10.476725,      0.023729,       0.035959,       0.051203,       0.314479,       2.580268,       9.450894,       0.172600,       0.377432,       -0.080498,      },
			{0.051122,      0.024933,       1.028133,       0.091875,       -3.486526,      2.223375,       0.018377,       0.033196,       0.046386,       0.044705,       3.511616,       1.196142,       0.178420,       0.122805,       -0.010656,      },
			{0.050996,      0.007365,       1.029851,       -2.154075,      -4.507826,      -27.935600,     0.037678,       0.029669,       0.031593,       2.205393,       4.515288,       28.965467,      -0.197981,      0.264883,       0.083912,       },
			{0.056858,      0.004564,       1.030073,       1.594775,       -2.520700,      5.174575,       0.025445,       0.040382,       0.041042,       1.538127,       2.525587,       4.144706,       -0.055869,      -0.015297,      0.032559,       },
			{0.043154,      0.027576,       1.027244,       1.923425,       -2.323475,      16.397326,      0.033872,       0.027332,       0.028227,       1.880577,       2.351210,       15.370108,      0.125706,       0.335796,       -0.044350,      },
			{0.037350,      0.043035,       1.025697,       2.266425,       -1.074325,      25.677919,      0.025321,       0.032032,       0.042156,       2.229219,       1.117819,       24.652260,      0.134851,       -0.147349,      0.056165,       },
			{0.018033,      0.025931,       1.025916,       1.222025,       -3.076675,      13.943123,      0.027146,       0.030929,       0.049770,       1.204298,       3.102761,       12.917303,      0.119860,       -0.036958,      -0.191578,      },
			{0.031121,      0.012958,       1.030120,       -0.298025,      -4.206825,      -18.677048,     0.022171,       0.035793,       0.045246,       0.329892,       4.219935,       19.707222,      0.046429,       0.240934,       0.077135,       },
			{0.057851,      0.024649,       1.028824,       -0.849275,      -4.374826,      -21.116201,     0.021194,       0.034646,       0.042689,       0.907374,       4.399611,       22.145067,      -0.005328,      0.205982,       0.010101,       },
			{0.018492,      0.009526,       1.029899,       -0.323575,      -3.676750,      -13.729096,     0.040392,       0.044308,       0.031580,       0.344443,       3.686542,       14.759029,      0.045209,       0.056808,       0.007511,       },
			{0.025173,      0.031980,       1.029796,       2.023525,       -2.594550,      17.901451,      0.022184,       0.029803,       0.037868,       1.998475,       2.626699,       16.871696,      -0.007827,      -0.351847,      -0.096392,      },
			{0.039745,      0.039999,       1.026149,       -0.000175,      -3.400075,      -3.572625,      0.026350,       0.037740,       0.057709,       0.047832,       3.440281,       4.599137,       -0.142763,      0.261584,       0.013678,       },
			{0.049858,      0.031725,       1.025176,       -0.029925,      -4.455325,      -23.199400,     0.032247,       0.031439,       0.041584,       0.086053,       4.487160,       24.224613,      -0.191207,      -0.129077,      -0.045837,      },
			{0.026063,      0.033005,       1.026281,       -0.602525,      -4.544049,      -12.702548,     0.034328,       0.040551,       0.040662,       0.629525,       4.577233,       13.728890,      -0.047898,      0.196987,       0.087651,       },
			{0.036870,      0.023291,       1.031018,       0.474250,       -2.947700,      6.169451,       0.022011,       0.028067,       0.058471,       0.437934,       2.971123,       5.138765,       -0.019892,      0.140715,       0.022305,       },
			{0.047568,      0.023080,       1.030884,       -0.710325,      -4.402300,      -21.804653,     0.024824,       0.036939,       0.042130,       0.758299,       4.425534,       22.835579,      -0.052861,      0.284266,       -0.033763,      },
			{0.041490,      -0.002019,      1.027486,       -1.852200,      -4.939200,      -35.493324,     0.025633,       0.032765,       0.028989,       1.893863,       4.937290,       36.520824,      -0.186415,      0.043537,       0.067144,       },
			{0.031692,      0.026412,       1.027809,       0.694050,       -3.277049,      5.929525,       0.035214,       0.028346,       0.025359,       0.663293,       3.303583,       4.901783,       -0.020233,      -0.281045,      -0.027965,      },
			{0.026889,      0.035591,       1.028942,       1.570275,       -2.517200,      18.013975,      0.024275,       0.031999,       0.034639,       1.543577,       2.552991,       16.985071,      0.220279,       -0.275893,      -0.013447,      },
			{0.038547,      0.032174,       1.029423,       -0.288050,      -3.179925,      6.025774,       0.026346,       0.035024,       0.044101,       0.327658,       3.212290,       4.996546,       0.011311,       0.088666,       0.027436,       },

			{-0.072649,     0.025697,       1.020556,       4.674599,       -3.686201,      9.189600,       0.248574,       0.079920,       0.179506,       4.753752,       3.712758,       8.171016,       0.142556,       -0.061956,      0.147743,       },
			{0.006848,      0.047358,       1.000950,       7.266350,       -8.077650,      -34.458546,     0.312926,       0.083294,       0.173911,       7.266244,       8.125434,       35.459923,      -0.221097,      0.505959,       0.037850,       },
			{-0.020235,     0.056179,       0.989902,       4.596200,       -4.449024,      -17.203197,     0.288860,       0.115370,       0.127963,       4.625463,       4.506680,       18.193548,      -0.297131,      -0.118749,      -0.100303,      },
			{-0.205646,     0.149276,       0.979344,       1.776774,       -5.664400,      -22.222378,     0.207424,       0.113011,       0.125092,       1.993242,       5.814774,       23.202059,      -0.001239,      0.122030,       0.015705,       },
			{0.034800,      0.038981,       1.002867,       4.045825,       -5.953676,      9.097023,       0.247796,       0.089159,       0.148325,       4.018672,       5.993320,       8.095515,       0.482997,       -0.086486,      -0.028157,      },
			{0.046774,      0.023838,       1.007883,       3.287375,       1.041425,       -7.275797,      0.216802,       0.077154,       0.111384,       3.247846,       1.020508,       8.284429,       -0.468510,      0.225115,       -0.115951,      },
			{0.062259,      0.016420,       0.981322,       0.121800,       -3.834424,      7.264252,       0.310966,       0.068566,       0.106728,       0.316615,       3.851454,       6.283836,       0.189761,       -0.009859,      0.147562,       },
			{-0.094853,     0.077981,       0.983549,       1.313025,       -6.690426,      -5.956649,      0.290905,       0.080850,       0.117711,       1.437618,       6.768890,       6.941197,       -0.026417,      0.246682,       -0.114130,      },
			{-0.034283,     0.008194,       1.010343,       5.830824,       0.862575,       30.627104,      0.248641,       0.087740,       0.127060,       5.870375,       0.858875,       29.617035,      0.334261,       -0.114477,      0.128009,       },
			{0.012344,      0.055630,       0.991428,       4.399849,       -5.342574,      12.689951,      0.266907,       0.091136,       0.148913,       4.395616,       5.398973,       11.699470,      -0.134463,      -0.296405,      0.062050,       },
			{-0.073859,     0.002453,       1.029962,       11.972625,      1.663026,       -8.465270,      0.157351,       0.098562,       0.130184,       12.047511,      1.663495,       9.496124,       -0.184513,      0.191608,       0.075333,       },
			{0.019618,      0.322511,       0.953319,       -5.734575,      12.602276,      32.995193,      0.183507,       0.197642,       0.165517,       5.757118,       12.281356,      32.042305,      0.202621,       -0.284047,      0.270880,       },
			{-0.026520,     0.053714,       0.978774,       2.319100,       -4.525675,      4.712925,       0.309290,       0.112310,       0.124622,       2.365923,       4.580767,       3.736229,       0.232335,       -0.205163,      0.103482,       },
			{-0.011297,     0.043832,       0.980176,       4.866749,       -8.514624,      -36.984501,     0.308216,       0.074867,       0.124123,       4.887774,       8.558784,       37.964882,      -0.390645,      0.151066,       -0.084998,      },
			{-0.013882,     0.083211,       0.989893,       8.341724,       -6.796125,      -16.892052,     0.324304,       0.104069,       0.130461,       8.361897,       6.880123,       17.882420,      -0.456323,      0.346791,       -0.175399,      },
			{-0.174864,     0.119699,       0.998463,       3.175550,       -7.200550,      -23.195545,     0.177479,       0.083319,       0.123788,       3.355111,       7.320723,       24.194324,      -0.078991,      -0.062287,      -0.007056,      },
			{0.035620,      0.133810,       0.987496,       5.891900,       1.895425,       16.321375,      0.250477,       0.151032,       0.131009,       5.861633,       1.768078,       15.334439,      -0.153313,      0.112869,       0.070902,       },
			{0.017996,      0.153175,       0.975158,       4.570125,       -0.030275,      -11.428553,     0.287141,       0.171976,       0.157534,       4.561176,       0.251455,       12.404712,      -0.430503,      0.180288,       -0.002217,      },
			{0.040644,      -0.021744,      1.002938,       -1.319325,      -1.383549,      6.134974,       0.224469,       0.126250,       0.138870,       1.378369,       1.367645,       5.133915,       0.094811,       0.352914,       -0.002617,      },
			{-0.150071,     0.117543,       0.990956,       1.160775,       -6.536426,      4.823174,       0.151354,       0.166123,       0.132424,       1.319555,       6.656043,       3.834506,       0.039215,       -0.117454,      0.021721,       },
			{-0.087597,     0.060234,       0.992786,       3.238025,       -0.299075,      -10.151574,     0.293099,       0.091842,       0.133942,       3.338514,       0.370861,       11.145164,      -0.103568,      -0.176768,      -0.162374,      },
			{0.112661,      0.074662,       0.995432,       -0.781200,      -6.111875,      -14.748648,     0.218697,       0.103209,       0.124727,       0.920226,       6.187397,       15.744576,      -0.100993,      0.577277,       -0.001246,      },
			{0.064262,      0.048566,       0.979399,       3.576125,       -0.895300,      23.187675,      0.297437,       0.086183,       0.107434,       3.524436,       0.947792,       22.208534,      0.255280,       -0.011520,      0.205123,       },
			{-0.060374,     0.069325,       1.009463,       -1.770650,      6.783000,       30.499704,      0.199730,       0.097025,       0.111402,       1.721899,       6.714375,       29.490452,      0.371086,       0.020756,       -0.157147,      },
			{-0.046641,     0.096148,       1.002497,       0.093275,       -9.483773,      -6.992652,      0.238253,       0.077132,       0.132559,       0.276298,       9.580233,       7.996248,       0.400019,       0.042528,       0.015126,       }
	};

	int testSetLabels[testSetSize] = { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
									   0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
	//normalizzazione del test set
	for (int i = 0; i < nOfFeatures; i++)
	{
		for (int sample = 0; sample < testSetSize; sample++)
		{
			testSet[sample][i] = testSet[sample][i] / max_values[i];
		}
	}

	//switch training
	switch (program_mode)
		{
		case 4:
		{
			TIM5->PSC = HAL_RCC_GetPCLK1Freq()/1000000 - 1;
			TIM5->CR1 = 1;
			train(inputNodes, hiddenNodes, outputNodes, trainingSetFeatures, trainingLabels);
			uint32_t time_el = TIM5->CNT;
			training_time=(float)time_el;
			training_time=training_time/scaling_time_factor;
			break;
		}
		case 5:
		{
			TIM5->PSC = HAL_RCC_GetPCLK1Freq()/1000000 - 1;
			TIM5->CR1 = 1;
			crosstrain(inputNodes, hiddenNodes, outputNodes, trainingSetFeatures, trainingLabels);
			uint32_t time_el = TIM5->CNT;
			training_time=(float)time_el;
			training_time=training_time/scaling_time_factor;
			break;
		}
		case 6:
		{
			TIM5->PSC = HAL_RCC_GetPCLK1Freq()/1000000 - 1;
			TIM5->CR1 = 1;
			train_hyperplane(trainingSetFeatures, trainingLabels, w, bias);
			uint32_t time_el = TIM5->CNT;
			training_time=(float)time_el;
			training_time=training_time/scaling_time_factor;
			break;
		}
	}
	training_time=training_time/1000;

	int testLabel=0;
	int correctClass=0;
	char *classMessage="";
	if(program_mode==0||program_mode==1||program_mode==2||program_mode==3)
	{
		TIM4->PSC = HAL_RCC_GetPCLK1Freq()/1000000 - 1;
		TIM4->CR1 = 1;
		for(int test=0;test<testSetSize;test++)
		{
			findKNN(trainingSetFeatures,indexes,testSet[test],dist_type);
			testLabel=classificate(trainingLabels, indexes, vote_type,
					 	trainingSetFeatures, testSet[test], dist_type);

			for (int i = 0; i<nOfSamples; i++)
			{
				indexes[i] = i;
			}

			if(testLabel==testSetLabels[test])
			{
				correctClass++;
			}
		}
		uint32_t time_el = TIM4->CNT;
		sample_time=(float)time_el;
		sample_time=sample_time/scaling_time_factor;
		sample_time=sample_time/testSetSize;

		/*
		//TIM4->PSC = HAL_RCC_GetPCLK1Freq()/1000000 - 1;
		//TIM4->CR1 = 1;
		uint32_t time_el = TIM4->CNT;
		sample_time=(float)time_el;
		sample_time=sample_time/scaling_time_factor;
		sample_time=sample_time/testSetSize;*/

		//HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		//HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		if(program_mode==0)
			classMessage="Classificazione tramite k-NN con distanza euclidea e voto di maggioranza";
		else if(program_mode==1)
			classMessage="Classificazione tramite k-NN con distanza euclidea e voto pesato";
		else if(program_mode==2)
			classMessage="Classificazione tramite k-NN con distanza Manhattan e voto di maggioranza";
		else if(program_mode==3)
			classMessage="Classificazione tramite k-NN con distanza Manhattan e voto pesato";
		HAL_UART_Transmit(&huart2, (uint8_t*)classMessage, strlen(classMessage), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		classMessage="Classificazioni corrette (su 50): ";
		HAL_UART_Transmit(&huart2, (uint8_t*)classMessage, strlen(classMessage), 0xFFFF);
		snprintf(buffer, sizeof buffer, "%i", correctClass);
		HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		classMessage="Tempo medio per la classificazione di un vettore in ms: ";
		HAL_UART_Transmit(&huart2, (uint8_t*)classMessage, strlen(classMessage), 0xFFFF);
		snprintf(buffer, sizeof buffer, "%5f", sample_time);
		HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
	}
	else if(program_mode==4||program_mode==5)
	{
		for(int test=0;test<testSetSize;test++)
		{
			testLabel=calculateSampleLabel(inputNodes,hiddenNodes,outputNodes,testSet[test]);
			if(testLabel==testSetLabels[test])
			{
						correctClass++;
			}
		}
		if(program_mode==4)
			classMessage="Classificazione con rete neurale addestrata su tutto il training set";
		//else if(program_mode==5)
			//classMessage="Classificazione con rete neurale addestrata con crosstrain";
		//HAL_UART_Transmit(&huart2, (uint8_t*)classMessage, strlen(classMessage), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		classMessage="Classificazioni corrette (su 50): ";
		HAL_UART_Transmit(&huart2, (uint8_t*)classMessage, strlen(classMessage), 0xFFFF);
		snprintf(buffer, sizeof buffer, "%i", correctClass);
		HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		classMessage="Tempo di addestramento (circa) in secondi: ";
		HAL_UART_Transmit(&huart2, (uint8_t*)classMessage, strlen(classMessage), 0xFFFF);
		snprintf(buffer, sizeof buffer, "%5f", training_time);
		HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);

		TIM4->PSC = HAL_RCC_GetPCLK1Freq()/1000000 - 1;
		TIM4->CR1 = 1;
		calculateOutput(inputNodes,hiddenNodes,outputNodes,testSet[6]);
		uint32_t time_el = TIM4->CNT;
		sample_time=(float)time_el;
		sample_time=sample_time/scaling_time_factor;
		classMessage="Tempo medio per la classificazione di un vettore in ms: ";
		HAL_UART_Transmit(&huart2, (uint8_t*)classMessage, strlen(classMessage), 0xFFFF);
		snprintf(buffer, sizeof buffer, "%9f", sample_time);
		HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);

		/*
				//TIM4->PSC = HAL_RCC_GetPCLK1Freq()/1000000 - 1;
				//TIM4->CR1 = 1;
				uint32_t time_el = TIM4->CNT;
				sample_time=(float)time_el;
				sample_time=sample_time/scaling_time_factor;*/

	}
	else if(program_mode==6)
	{
		for(int test=0;test<testSetSize;test++)
		{
			testLabel = predictLabel(w,testSet[test],bias);
			if (testLabel == 1 && testSetLabels[test] == 1)
						{
							correctClass++;
						}
						else if (testLabel == -1 && testSetLabels[test] == 0)
						{
							correctClass++;
						}
		}
		classMessage="Classificazione tramite perceptron classifier";
		HAL_UART_Transmit(&huart2, (uint8_t*)classMessage, strlen(classMessage), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		classMessage="Classificazioni corrette (su 50): ";
		HAL_UART_Transmit(&huart2, (uint8_t*)classMessage, strlen(classMessage), 0xFFFF);
		snprintf(buffer, sizeof buffer, "%i", correctClass);
		HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		classMessage="Tempo di addestramento (circa) in secondi: ";
		HAL_UART_Transmit(&huart2, (uint8_t*)classMessage, strlen(classMessage), 0xFFFF);
		snprintf(buffer, sizeof buffer, "%5f", training_time);
		HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);

		TIM4->PSC = HAL_RCC_GetPCLK1Freq()/1000000 - 1;
		TIM4->CR1 = 1;
		predictLabel(w,testSet[6], bias);
		//HAL_Delay(100);
		uint32_t time_el = TIM4->CNT;
		sample_time=(float)time_el;
		sample_time=sample_time/scaling_time_factor;
		classMessage="Tempo medio per la classificazione di un vettore in ms: ";
		HAL_UART_Transmit(&huart2, (uint8_t*)classMessage, strlen(classMessage), 0xFFFF);
		snprintf(buffer, sizeof buffer, "%5f", sample_time);
		HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
	}
	//serve per l'eventuale crosstrain
//	int indexNoTrain[sampleToAvoid * 2] = { 0 };

	//selezione della modalit di funzionamento in base alla variabile "mode"
	/*
	switch (mode)
	{
	//inizializzazione della rete tramite valori random
	case WORK_MODE_RANDOM_SETUP:
		randomSetupNodes(inputNodes, hiddenNodes, outputNodes);
		break;
	//caricamento dei valori della rete da valori cablati nella funzione "loadTrainedNetwork"
	//(sono) valori ricavati da un training, il contenuto della funzione  scritto in console da
	//"printNetwork"
	case WORK_MODE_LOAD_NETWORK_FROM_FUNCTION:
		loadTrainedNetwork(inputNodes, hiddenNodes, outputNodes);
		break;

	//addestramento della rete utilizzando il training set cablato nel programma
	case WORK_MODE_TRAIN_FROM_DATA_IN_PROGRAM:

		randomSetupNodes(inputNodes, hiddenNodes, outputNodes);

		//se il crosstrain  abilitato:
		//suddivido il training set in training e test con percentuali 70 e 30 => 70 vettori di training (35 per ogni classe) e 30 di test (15 per ogni classe)
		//generazione dei 15+15 indici random
		if (ct == CROSSTRAIN_ENABLED)
		{
			crosstrain(inputNodes, hiddenNodes, outputNodes,	trainingSetFeatures, trainingLabels);
		}
		//no crosstrain
		else
		{
			train(inputNodes, hiddenNodes, outputNodes,	trainingSetFeatures, trainingLabels);
		}
		break;
	}//fine switch
	*/
	//contenitori temporanei per accogliere i dati sensoriali
	float acc[3] = { 0 };
	float gyro[3] = { 0 };
	int cycleNum = 0;

	//contengono i campioni che vengono composti e vengono classificati
	float sampleToClassify_accelerationX[vectorLength] = { 0 };
	float sampleToClassify_accelerationY[vectorLength] = { 0 };
	float sampleToClassify_accelerationZ[vectorLength] = { 0 };

	float sampleToClassify_gyroX[vectorLength] = { 0 };
	float sampleToClassify_gyroY[vectorLength] = { 0 };
	float sampleToClassify_gyroZ[vectorLength] = { 0 };

	//contenitore per le features del vettore che viene classificato
	float sampleFeatures[nOfFeatures] = { 0 };

	//int cycleNumber=0;

	/*
	//test var

	float test[8]={1,7,3,9,10,22,0,6};

	float test_mean = calculateMean(test);
	snprintf(buffer, sizeof buffer, "%f", test_mean);
	HAL_UART_Transmit(&huart2, (uint8_t*) buffer, strlen(buffer), 0xFFFF);
	HAL_UART_Transmit(&huart2, (uint8_t*) newline, strlen(newline), 0xFFFF);

	float var_test=calculateVar(test, test_mean);
	snprintf(buffer, sizeof buffer, "%f", var_test);
	HAL_UART_Transmit(&huart2, (uint8_t*) buffer, strlen(buffer), 0xFFFF);
	HAL_UART_Transmit(&huart2, (uint8_t*) newline, strlen(newline), 0xFFFF);

	float std_dev=sqrt(var_test);
	snprintf(buffer, sizeof buffer, "%f", std_dev);
	HAL_UART_Transmit(&huart2, (uint8_t*) buffer, strlen(buffer), 0xFFFF);
	HAL_UART_Transmit(&huart2, (uint8_t*) newline, strlen(newline), 0xFFFF);
*/
	//etichetta del campione classificato
	int c_label;
	float out_value;
	char *class="";

	//printNetwork(inputNodes,hiddenNodes,outputNodes);
int cycleNumber=0;
if(0==1)
	for (;;)
	{
		//lettura valori
		LSM6DSL_ReadAcceleration(acc);
		LSM6DSL_ReadGyro(gyro);
//stampa valori ad ogni giro


		if(show_sens_data == SHOW_SENS_DATA)
		{
		for (int i = 0; i < 3; i++)
		{
			snprintf(buffer, sizeof buffer, "%f", acc[i]);
			HAL_UART_Transmit(&huart2, (uint8_t*) buffer, strlen(buffer), 0xFFFF);
			HAL_UART_Transmit(&huart2, (uint8_t*) tab, strlen(tab), 0xFFFF);
		}
		for (int i = 0; i < 3; i++)
		{
			snprintf(buffer, sizeof buffer, "%f", gyro[i]);
			HAL_UART_Transmit(&huart2, (uint8_t*) buffer, strlen(buffer), 0xFFFF);
			HAL_UART_Transmit(&huart2, (uint8_t*) tab, strlen(tab), 0xFFFF);
		}
		HAL_UART_Transmit(&huart2, (uint8_t*) newline, strlen(newline), 0xFFFF);
		}
		//se il vettore da classificare non  ancora pieno aggiungo il valore appena letto
		if (cycleNum < vectorLength)
		{
			sampleToClassify_accelerationX[cycleNum] = acc[0];
			sampleToClassify_accelerationY[cycleNum] = acc[1];
			sampleToClassify_accelerationZ[cycleNum] = acc[2];
			/*
			 for(int i = 0; i<3;i++)
			 {
			 snprintf(buffer, sizeof buffer, "%f", acc[i]);
			 HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
			 HAL_UART_Transmit(&huart2, (uint8_t*)tab, strlen(tab), 0xFFFF);
			 }
			 */
			sampleToClassify_gyroX[cycleNum] = gyro[0];
			sampleToClassify_gyroY[cycleNum] = gyro[1];
			sampleToClassify_gyroZ[cycleNum] = gyro[2];
			/*
			 for(int i = 0; i<3;i++)
			 {
			 snprintf(buffer, sizeof buffer, "%f", gyro[i]);
			 HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
			 HAL_UART_Transmit(&huart2, (uint8_t*)tab, strlen(tab), 0xFFFF);
			 }
			 HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
			 */
			cycleNum++;
		}
		//altrimenti vengono estratte le features
		else
		{
			cycleNumber++;
			cycleNum = 0;
/*
			for(int i = 0; i<vectorLength;i++)
			{
				snprintf(buffer, sizeof buffer, "%f", sampleToClassify_gyroX[i]);
				HAL_UART_Transmit(&huart2, (uint8_t*) buffer, strlen(buffer), 0xFFFF);
				HAL_UART_Transmit(&huart2, (uint8_t*) newline, strlen(newline), 0xFFFF);
			}
*/
			sampleFeatures[0] = calculateMean(sampleToClassify_accelerationX);
			sampleFeatures[1] = calculateMean(sampleToClassify_accelerationY);
			sampleFeatures[2] = calculateMean(sampleToClassify_accelerationZ);
			sampleFeatures[3] = calculateMean(sampleToClassify_gyroX);
			sampleFeatures[4] = calculateMean(sampleToClassify_gyroY);
			sampleFeatures[5] = calculateMean(sampleToClassify_gyroZ);
			sampleFeatures[6] = sqrt(calculateVar(sampleToClassify_accelerationX,sampleFeatures[0]));
			sampleFeatures[7] = sqrt(calculateVar(sampleToClassify_accelerationY,sampleFeatures[1]));
			sampleFeatures[8] = sqrt(calculateVar(sampleToClassify_accelerationZ,sampleFeatures[2]));
			sampleFeatures[9] = sqrt(calculateVar(sampleToClassify_accelerationX,sampleFeatures[3]));
			sampleFeatures[10] = sqrt(calculateVar(sampleToClassify_accelerationY,sampleFeatures[4]));
			sampleFeatures[11] = sqrt(calculateVar(sampleToClassify_accelerationZ,sampleFeatures[5]));
			sampleFeatures[12] = calculateCorr(sampleToClassify_accelerationX,sampleToClassify_gyroX, sampleFeatures[0],sampleFeatures[3]);
			sampleFeatures[13] = calculateCorr(sampleToClassify_accelerationY,sampleToClassify_gyroY, sampleFeatures[1],sampleFeatures[4]);
			sampleFeatures[14] = calculateCorr(sampleToClassify_accelerationZ,sampleToClassify_gyroZ, sampleFeatures[2],sampleFeatures[5]);


			 HAL_UART_Transmit(&huart2, (uint8_t*)openGraffa, strlen(openGraffa), 0xFFFF);
			 for(int ri = 0; ri<nOfFeatures; ri++)
			 {
				 snprintf(buffer, sizeof buffer, "%f", sampleFeatures[ri]);
				 HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
				 HAL_UART_Transmit(&huart2, (uint8_t*)virgola, strlen(virgola), 0xFFFF);
				 HAL_UART_Transmit(&huart2, (uint8_t*)tab, strlen(tab), 0xFFFF);
			 }
			 HAL_UART_Transmit(&huart2, (uint8_t*)closeGraffa, strlen(closeGraffa), 0xFFFF);
			 HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
//vengono normalizzate le features estratte
			 for (int i=0;i<nOfFeatures;i++)
			 {
				 sampleFeatures[i]=sampleFeatures[i]/max_values[i];
			 }
			 //si calcola l'output della rete fornendo il vettore come input
			 //c_label = calculateSampleLabel(inputNodes,hiddenNodes,outputNodes,sampleFeatures);


			 if(program_mode==0||program_mode==1||program_mode==2||program_mode==3)
			 {
				 findKNN(trainingSetFeatures,indexes,sampleFeatures,dist_type);
				 c_label=classificate(trainingLabels, indexes, vote_type,
				 		trainingSetFeatures, sampleFeatures, dist_type);
			 }
			 else if(program_mode==4||program_mode==5)
			 {
			 	c_label=calculateSampleLabel(inputNodes,hiddenNodes,outputNodes,sampleFeatures);
			 }
			 else if(program_mode==6)
			 {
			 		c_label = predictLabel(w,sampleFeatures,bias);
			 		break;
			 }






			 snprintf(buffer, sizeof buffer, "%i", c_label);
			 HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
			 HAL_UART_Transmit(&huart2, (uint8_t*)tab, strlen(tab), 0xFFFF);

			 //out_value = calculateOutput(inputNodes,hiddenNodes,outputNodes,sampleFeatures);
			 //snprintf(buffer, sizeof buffer, "%f", out_value);
			 //HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);

			 //snprintf(buffer, sizeof buffer, "%i", cycleNumber);
			 //HAL_UART_Transmit(&huart2, (uint8_t*)buffer, strlen(buffer), 0xFFFF);
			 //per etichetta 0 il campione  considerato come alterato e viene acceso il LED come
			 //feedback visivo per l'utente, in caso contrario esso viene spento
/*
			 if (c_label == 0)
			{
				class=" alterato\t\t";
				BSP_LED_On(LED2);
			}
			else
			{
				class=" normale\t\t";
				BSP_LED_Off(LED2);
			}
*/
			HAL_UART_Transmit(&huart2, (uint8_t*) newline, strlen(newline),	0xFFFF);
			HAL_UART_Transmit(&huart2, (uint8_t*)class, strlen(class), 0xFFFF);
			HAL_UART_Transmit(&huart2, (uint8_t*) newline, strlen(newline),	0xFFFF);
/*
			if(cycleNumber==50)
			{
				char *msg2="fine numero50";
				HAL_UART_Transmit(&huart2, (uint8_t*) newline, strlen(newline),0xFFFF);
				HAL_UART_Transmit(&huart2, (uint8_t*) msg2, strlen(msg2),0xFFFF);
			}
*/
		}
		//HAL_UART_Transmit(&huart2, (uint8_t*)newline, strlen(newline), 0xFFFF);
		HAL_Delay(sampleTime);
	}
}
//non potendo utilizzare la data e ora (time(NULL)) come seed per la funzione srand di inizializzazione
//del generatore di numeri casuali si utilizza un valore preso dal sensore (nel caso accelerazione su asse z)
int Rand_value_acc()
{
	int val = 0;
	float temp = 0.0;
	float acc_val[3] = { 0 };
	LSM6DSL_ReadAcceleration(acc_val);
	temp = acc_val[2] * 10000000;
	val = (int) temp;
	return val;
}
